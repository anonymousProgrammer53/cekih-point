<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cekih point</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body data-bs-theme="light">
    <nav>
        <div class="container mb-3">
            <div class="row">
                <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 m-auto">
                    <ul class="nav nav-underline justify-content-center gap-3">
                        <li class="nav-item">
                            <button class="nav-link active">cekih
                                point</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link">riwayat</button>
                        </li>
                        <li class="nav-item">
                            <button id="toggleMode" class="nav-link btn-dark">ðŸŒ™ gelap</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <main>
        <section id="cekihPointPage">
            <div class="container mt-3">
                <div class="row">
                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 m-auto">
                        <div id="playerCard1" class="card btn btn-outline-primary mb-3 w-100 text-start">
                            <div class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                <h6 class="card-subtitle m-0">Player 1</h6>
                                <h5 class="card-title m-0">0</h5>
                            </div>
                        </div>
                        <div id="playerCard2" class="card btn btn-outline-primary mb-3 w-100 text-start">
                            <div class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                <h6 class="card-subtitle m-0">Player 2</h6>
                                <h5 class="card-title m-0">0</h5>
                            </div>
                        </div>
                        <div id="playerCard3" class="card btn btn-outline-primary mb-3 w-100 text-start">
                            <div class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                <h6 class="card-subtitle m-0">Player 3</h6>
                                <h5 class="card-title m-0">0</h5>
                            </div>
                        </div>
                        <div id="playerCard4" class="card btn btn-outline-primary mb-3 w-100 text-start">
                            <div class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                <h6 class="card-subtitle m-0">Player 4</h6>
                                <h5 class="card-title m-0">0</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container mb-3">
                <div class="row">
                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 m-auto">
                        <div class="card">
                            <div class="card-body">
                                <form id="pointControlForm">
                                    <div class="d-flex align-items-center gap-3 justify-content-between
                                     mb-3">
                                        <input type="number" id="insertNumber" class="form-control form-control-lg fs-3"
                                            placeholder="insert number" aria-label=".form-control-lg">
                                        <button type="button" id="minusPointBtn"
                                            class="btn btn-lg btn-danger fw-bold w-25 fs-3">
                                            -
                                        </button>
                                        <button type="button" id="plusPointBtn"
                                            class="btn btn-lg btn-primary fw-bold w-25 fs-3">
                                            +
                                        </button>
                                    </div>
                                    <button type="button" id="resetPointBtn"
                                        class="btn btn-danger btn-lg d-block mb-3 w-100 fw-semibold fs-4">KENA
                                        KEME</button>
                                    <button type="button" id="newGameBtn"
                                        class="btn btn-primary btn-lg d-block w-100 fw-semibold fs-4"
                                        data-bs-toggle="modal" data-bs-target="#formInputPlayerNameModal">Permainan
                                        Baru</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="formInputPlayerNameModal" data-bs-backdrop="static" data-bs-keyboard="false"
                tabindex="-1" aria-labelledby="inputPlayerModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title m-auto">Masukkan Nama Pemain</h5>
                        </div>
                        <div class="modal-body">
                            <form id="playerNameForm">
                                <div class="mb-3">
                                    <label for="inputPlayerName1" class="form-label fw-semibold">Player 1
                                        <span class="text-danger">*</span></label>
                                    <input id="inputPlayerName1" class="form-control" type="text"
                                        placeholder="Masukkan nama" required>
                                </div>
                                <div class="mb-3">
                                    <label for="inputPlayerName2" class="form-label fw-semibold">Player 2
                                        <span class="text-danger">*</span></label>
                                    <input id="inputPlayerName2" class="form-control" type="text"
                                        placeholder="Masukkan nama" required>
                                </div>
                                <div class="mb-3">
                                    <label for="inputPlayerName3" class="form-label fw-semibold">Player 3
                                        <span class="text-danger">*</span></label>
                                    <input id="inputPlayerName3" class="form-control" type="text"
                                        placeholder="Masukkan nama" required>
                                </div>
                                <div class="mb-3">
                                    <label for="inputPlayerName4" class="form-label fw-semibold">Player 4
                                        <span class="text-danger">*</span></label>
                                    <input id="inputPlayerName4" class="form-control" type="text"
                                        placeholder="Masukkan nama" required>
                                </div>
                                <div class="d-grid mt-4">
                                    <button type="button" id="playNowBtn"
                                        class="btn btn-primary btn-lg d-block w-100 fw-semibold">Main Sekarang!</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="historyPage" class="d-none">
            <div class="container mt-3 mb-3">
                <div class="row">
                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 m-auto">
                        <h1>Riwayat Permainan</h1>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <nav>
            <div class="container mt-3 mb-3 text-center">
                <div class="row">
                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 m-auto">
                        <div class="navbar-text">
                            -- Dibikin dengan penuh cinta dan kasih sayang by <span class="fw-semibold text-danger">AA
                                SASUKE</span> --
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        // fungsi untuk berpindah2 halaman
        const openPage = (allPage, allLink, pageNameId, currentElement, activeTab) => {
            document.querySelectorAll(allPage).forEach((page) => {
                page.classList.remove('d-block');
                page.classList.add('d-none');
            });

            document.querySelectorAll(allLink).forEach((link) => {
                link.classList.remove('active');
            });

            document.getElementById(pageNameId).classList.remove('d-none');
            document.getElementById(pageNameId).classList.add('d-block');

            currentElement.classList.add('active');

            localStorage.setItem(activeTab, pageNameId);
        };

        document.querySelector('nav').addEventListener('click', (e) => {
            if (e.target.classList.contains('nav-link')) {
                if (e.target.innerText.trim() === 'cekih point') {
                    openPage('main > section', 'nav .nav-link', 'cekihPointPage', e.target, 'activeTab');
                } else if (e.target.innerText.trim() === 'riwayat') {
                    openPage('main > section', 'nav .nav-link', 'historyPage', e.target, 'activeTab');
                }
            }
        });

        // fungsi untuk mengembalikan halaman terakhir yang aktif
        const lastActivePage = () => {
            return document.querySelectorAll('nav .nav-link').forEach((navLink) => {
                if ((navLink.innerText.trim() === 'cekih point' && localStorage.getItem('activeTab') === 'cekihPointPage') ||
                    (navLink.innerText.trim() === 'riwayat' && localStorage.getItem('activeTab') === 'historyPage')) {
                    navLink.click();
                }
            });
        }

        // fungsi untuk mengubah tema bg warna
        document.getElementById("toggleMode").addEventListener("click", (e) => {
            if (document.body.getAttribute("data-bs-theme") === "light") {
                document.body.setAttribute("data-bs-theme", "dark");
                localStorage.setItem("dataBsTheme", "dark");
                e.target.innerText = "â˜€ï¸ terang";
            } else {
                document.body.setAttribute("data-bs-theme", "light");
                localStorage.setItem("dataBsTheme", "light");
                e.target.innerText = "ðŸŒ™ gelap";
            }
        });

        // fungsi untuk mengembalikan tema bg warna terakhir yang aktif
        const lastActiveDataBsTheme = () => {
            if (localStorage.getItem("dataBsTheme") === "dark") {
                document.body.setAttribute("data-bs-theme", "dark");
                document.getElementById("toggleMode").innerText = "â˜€ï¸ terang";
            } else {
                document.body.setAttribute("data-bs-theme", "light");
                document.getElementById("toggleMode").innerText = "ðŸŒ™ gelap";
            }
        }

        // fungsi untuk mengambil komponen kartu pemain berdasarkan id
        const getPlayerCard = () => {
            return {
                playerCard1: document.getElementById('playerCard1'),
                playerCard2: document.getElementById('playerCard2'),
                playerCard3: document.getElementById('playerCard3'),
                playerCard4: document.getElementById('playerCard4')
            };
        }

        // fungsi untuk mengambil komponen nama pemain berdasarkan fungsi getPlayerCard
        const getPlayerName = () => {
            return {
                playerName1: getPlayerCard().playerCard1.querySelector('.card-subtitle'),
                playerName2: getPlayerCard().playerCard2.querySelector('.card-subtitle'),
                playerName3: getPlayerCard().playerCard3.querySelector('.card-subtitle'),
                playerName4: getPlayerCard().playerCard4.querySelector('.card-subtitle')
            };
        }

        // fungsi untuk mengambil komponen poin pemain berdasarkan fungsi getPlayerCard
        const getPlayerPoint = () => {
            return {
                playerPoint1: getPlayerCard().playerCard1.querySelector('.card-title'),
                playerPoint2: getPlayerCard().playerCard2.querySelector('.card-title'),
                playerPoint3: getPlayerCard().playerCard3.querySelector('.card-title'),
                playerPoint4: getPlayerCard().playerCard4.querySelector('.card-title'),
            };
        }

        // fungsi untuk mengambil komponen pointControlForm
        const getPointControlForm = () => {
            const pointControlForm = document.getElementById('pointControlForm');
            return {
                pointControlForm: pointControlForm,
                insertNumber: pointControlForm.querySelector('#insertNumber'),
                minusPointBtn: pointControlForm.querySelector('#minusPointBtn'),
                plusPointBtn: pointControlForm.querySelector('#plusPointBtn'),
                resetPointBtn: pointControlForm.querySelector('#resetPointBtn'),
                newGameBtn: pointControlForm.querySelector('#newGameBtn'),
            };
        };

        // fungsi untuk memilih pemain
        const selectedPlayerCard = (selectedPlayer) => {
            Object.values(getPlayerCard()).forEach((card) => {
                card.classList.remove('bg-primary');
            });

            selectedPlayer.classList.add('bg-primary');
        }

        // fungsi untuk mentriger event fungsi memilih pemain
        getPlayerCard().playerCard1.addEventListener('click', () => {
            selectedPlayerCard(getPlayerCard().playerCard1);
        });

        getPlayerCard().playerCard2.addEventListener('click', () => {
            selectedPlayerCard(getPlayerCard().playerCard2);
        });

        getPlayerCard().playerCard3.addEventListener('click', () => {
            selectedPlayerCard(getPlayerCard().playerCard3);
        });

        getPlayerCard().playerCard4.addEventListener('click', () => {
            selectedPlayerCard(getPlayerCard().playerCard4);
        });

        const updatePlayerPoint = (isAdding) => {
            let selectedPlayer = Object.values(getPlayerCard()).find(card => card.classList.contains('bg-primary'));

            if (!selectedPlayer) {
                alert('Pilih pemain terlebih dahulu!');
                return;
            }

            let playerPointElements = getPlayerPoint();
            let playerPointKey = Object.keys(getPlayerCard()).find(key => getPlayerCard()[key] === selectedPlayer);
            let playerPointElement = playerPointElements[playerPointKey.replace('Card', 'Point')];

            let inputValue = parseInt(getPointControlForm().insertNumber.value) || 0;
            let currentPoints = parseInt(playerPointElement.innerText) || 0;

            if (isNaN(inputValue) || inputValue <= 0 || inputValue % 5 !== 0 || inputValue > 1000) {
                alert('Masukkan angka yang valid! (hanya kelipatan 5, max 1000)');
                return;
            }

            let newPoints = isAdding ? currentPoints + inputValue : currentPoints - inputValue;
            playerPointElement.innerText = newPoints;

            // ðŸ”¥ Simpan ke localStorage dengan key yang unik
            let playerPoints = JSON.parse(localStorage.getItem('playerPoints')) || {};
            playerPoints[playerPointKey] = newPoints;
            localStorage.setItem('playerPoints', JSON.stringify(playerPoints));

            console.log('Poin tersimpan:', playerPoints); // ðŸ” Debugging untuk melihat apakah poin tersimpan

            getPointControlForm().insertNumber.value = '';
        };

        const lastPlayerPoints = () => {
            let playerPoints = JSON.parse(localStorage.getItem('playerPoints')) || {};
            // Tetapkan nilai dari localStorage atau default 0
            getPlayerPoint().playerPoint1.innerText = playerPoints.playerCard1 || 0;
            getPlayerPoint().playerPoint2.innerText = playerPoints.playerCard2 || 0;
            getPlayerPoint().playerPoint3.innerText = playerPoints.playerCard3 || 0;
            getPlayerPoint().playerPoint4.innerText = playerPoints.playerCard4 || 0;
        };

        const resetPlayerPoint = () => {
            let selectedPlayer = Object.values(getPlayerCard()).find(card => card.classList.contains('bg-primary'));

            if (!selectedPlayer) {
                alert('Pilih pemain terlebih dahulu!');
                return;
            }

            // Dapatkan elemen poin pemain
            let playerPointElements = getPlayerPoint();
            let playerPointKey = Object.keys(getPlayerCard()).find(key => getPlayerCard()[key] === selectedPlayer);
            let playerPointElement = playerPointElements[playerPointKey.replace('Card', 'Point')];

            // Ambil nilai poin saat ini
            let currentPoints = parseInt(playerPointElement.innerText) || 0;

            // Cek apakah poin sudah mencapai 100 atau lebih
            if (currentPoints < 100) {
                alert('Poin pemain ini belum mencapai 100. Tidak bisa diKEME!');
                return;
            }

            // Konfirmasi sebelum reset
            let confirmReset = confirm("Apakah Anda yakin ingin mengKEME pemain ini?");
            if (!confirmReset) return; // Jika user klik "Batal", hentikan proses

            // Set poin di tampilan menjadi 0
            playerPointElement.innerText = 0;

            // Update data di localStorage
            let playerPoints = JSON.parse(localStorage.getItem('playerPoints')) || {};
            playerPoints[playerPointKey] = 0;
            localStorage.setItem('playerPoints', JSON.stringify(playerPoints));

            // Alert sukses
            alert(`Selamat Anda kena KEME, point Anda kembali lagi ke 0`);
        };

        const newGame = () => {
            // Reset poin pemain ke 0
            let playerPoints = {};
            let playerPointElements = getPlayerPoint();
            Object.keys(playerPointElements).forEach(key => {
                playerPointElements[key].innerText = 0;
                playerPoints[key.replace('Point', 'Card')] = 0;
            });

            // Reset nama pemain ke default
            let playerNames = {};
            let playerNameElements = getPlayerName();
            Object.keys(playerNameElements).forEach((key, index) => {
                let defaultName = `Pemain ${index + 1}`;
                playerNameElements[key].innerText = defaultName;
                playerNames[key.replace('Name', 'Card')] = defaultName;
            });

            // Simpan ke localStorage
            localStorage.setItem('playerPoints', JSON.stringify(playerPoints));
            localStorage.setItem('playerNames', JSON.stringify(playerNames));

            // Tampilkan modal box hanya jika user setuju
            let newGameModal = new bootstrap.Modal(document.getElementById('newGameModal'));
            newGameModal.show();
        };

        // Event listener untuk tombol plus dan minus
        getPointControlForm().minusPointBtn.addEventListener('click', () => updatePlayerPoint(false));
        getPointControlForm().plusPointBtn.addEventListener('click', () => updatePlayerPoint(true));
        getPointControlForm().resetPointBtn.addEventListener('click', () => resetPlayerPoint());
        getPointControlForm().newGameBtn.addEventListener('click', newGame);

        const getPlayerNameForm = () => {
            const playerNameForm = document.getElementById('playerNameForm');
            return {
                playerNameForm: playerNameForm,
                valueInputPlayerName1: playerNameForm.querySelector('#inputPlayerName1').value,
                valueInputPlayerName2: playerNameForm.querySelector('#inputPlayerName2').value,
                valueInputPlayerName3: playerNameForm.querySelector('#inputPlayerName3').value,
                valueInputPlayerName4: playerNameForm.querySelector('#inputPlayerName4').value,
                playNowBtn: playerNameForm.querySelector('#playNowBtn'),
            };
        };

        document.getElementById('playNowBtn').addEventListener('click', () => {
            let playerNames = {
                playerCard1: getPlayerNameForm().valueInputPlayerName1.trim() || 'Player 1',
                playerCard2: getPlayerNameForm().valueInputPlayerName2.trim() || 'Player 2',
                playerCard3: getPlayerNameForm().valueInputPlayerName3.trim() || 'Player 3',
                playerCard4: getPlayerNameForm().valueInputPlayerName4.trim() || 'Player 4',
            };

            // Set nama pemain di UI
            getPlayerName().playerName1.textContent = playerNames.playerCard1;
            getPlayerName().playerName2.textContent = playerNames.playerCard2;
            getPlayerName().playerName3.textContent = playerNames.playerCard3;
            getPlayerName().playerName4.textContent = playerNames.playerCard4;

            // Simpan ke localStorage
            localStorage.setItem('playerNames', JSON.stringify(playerNames));

            // Kosongkan input setelah submit
            document.getElementById('inputPlayerName1').value = '';
            document.getElementById('inputPlayerName2').value = '';
            document.getElementById('inputPlayerName3').value = '';
            document.getElementById('inputPlayerName4').value = '';

            // Tutup modal jika ada
            if (formInputPlayerNameModal) {
                formInputPlayerNameModal.hide();
            }
        });


        const lastPlayerNames = () => {
            let playerNames = JSON.parse(localStorage.getItem('playerNames')) || {
                playerCard1: 'Player 1',
                playerCard2: 'Player 2',
                playerCard3: 'Player 3',
                playerCard4: 'Player 4'
            };

            getPlayerName().playerName1.textContent = playerNames.playerCard1;
            getPlayerName().playerName2.textContent = playerNames.playerCard2;
            getPlayerName().playerName3.textContent = playerNames.playerCard3;
            getPlayerName().playerName4.textContent = playerNames.playerCard4;
        };

        // Panggil saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            let modalElement = document.getElementById('formInputPlayerNameModal');

            if (modalElement) {  // Pastikan elemen modal ada sebelum inisialisasi
                formInputPlayerNameModal = new bootstrap.Modal(modalElement);
            }

            lastActivePage();
            lastActiveDataBsTheme();
            lastPlayerPoints();
            lastPlayerNames();
        });
    </script>
</body>

</html>
